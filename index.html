<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–º—É–ª—è—Ç–æ—Ä –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ–≥–æ –ü—Ä–æ–¥—é—Å–µ—Ä–∞</title> <!-- –ò–∑–º–µ–Ω–µ–Ω–æ -->
    <style>
        /* CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Ç –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏ */
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap');
        :root { /* ...–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ... */
             --primary-color: #e74c3c; --secondary-color: #3498db; --income-color: #2ecc71; --cost-color: #f39c12; --background-light: #f4f6f9; --background-white: #ffffff; --text-dark: #2c3e50; --text-light: #555; --border-color: #dfe4ea; --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.08); --card-hover-shadow: 0 6px 12px rgba(0, 0, 0, 0.12); --selected-border: 3px solid var(--secondary-color);
         }
         body { font-family: 'Nunito', sans-serif; background-color: var(--background-light); color: var(--text-dark); line-height: 1.6; min-height: 100vh; padding: 20px; box-sizing: border-box; }
         .stats-sticky-wrapper { position: sticky; top: 10px; z-index: 100; margin-bottom: 20px; }
         .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; background-color: var(--background-white); padding: 12px 15px; border-radius: 10px; font-weight: 700; box-shadow: 0 3px 8px rgba(0,0,0,0.1); text-align: center; border: 1px solid var(--border-color); max-width: 850px; margin: 0 auto; cursor: default; }
         .stats div { font-size: 1.0em; }
         .stats span { font-size: 1.1em; display: inline-block; margin-top: 3px; font-weight: 700; transition: color 0.15s ease-out, transform 0.15s ease-out; }
         #budget { color: var(--primary-color); } #audience-size { color: var(--secondary-color); } #daily-income { color: var(--income-color); } #weekly-income { color: var(--income-color); } #week { color: var(--text-light); }
         .container { background-color: var(--background-white); padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); width: 100%; max-width: 850px; margin: 0 auto; }
         h1, h2 { text-align: center; margin-bottom: 20px; color: var(--text-dark); }
         h1 { color: var(--primary-color); font-weight: 700; margin-top: 0; } h2 { color: var(--secondary-color); margin-top: 30px; } h3 { margin-bottom: 15px; color: var(--text-light); border-bottom: 1px solid var(--border-color); padding-bottom: 5px; font-size: 1.2em; }
         .ad-creator { margin-bottom: 25px; } .option-group { margin-bottom: 25px; }
         .card-container { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
         .card { background-color: var(--background-white); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s ease-in-out; box-shadow: var(--card-shadow); flex: 1 1 115px; min-width: 115px; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: space-between; }
         .card:hover { transform: translateY(-3px) scale(1.03); box-shadow: var(--card-hover-shadow); }
         .card.selected { border: var(--selected-border); box-shadow: var(--card-hover-shadow); background-color: #e9f5ff; transform: scale(1.05); }
         .card-icon { font-size: 2.5em; margin-bottom: 10px; line-height: 1; } .card-title { font-weight: 700; margin-bottom: 5px; font-size: 0.9em; color: var(--text-dark); } .card-desc { font-size: 0.75em; color: var(--text-light); min-height: 30px; }
         .card[data-category="style"] .card-icon { font-size: 2em; }
         .cost-summary { margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color); display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-items: center; margin-bottom: 15px; }
         .cost-item { text-align: center; } .cost-item label { font-weight: 700; color: var(--text-light); display: block; margin-bottom: 5px; font-size: 0.9em; } .cost-item span, .cost-item input { font-size: 1.2em; font-weight: 700; }
         #creative-cost-display { color: var(--cost-color); } #campaign-cost { padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; width: 110px; text-align: right; }
         .ad-preview { margin-top: 15px; text-align: center; margin-bottom: 15px; } .ad-preview h4 { margin: 0 0 5px 0; color: var(--text-light); font-size: 0.9em; font-weight: normal;} .preview-icons { font-size: 1.8em; word-spacing: 10px; min-height: 35px; line-height: 1; }
         .action-buttons { display: flex; gap: 15px; margin-top: 25px; }
         #launch-button, #skip-week-button { flex-grow: 1; padding: 15px 20px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-align: center; }
         #launch-button { background: linear-gradient(45deg, var(--primary-color), #f56555); color: white; box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3); }
         #launch-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4); } #launch-button:active:not(:disabled) { transform: translateY(0px); box-shadow: 0 2px 5px rgba(231, 76, 60, 0.2); } #launch-button:disabled { background: #bdc3c7; cursor: not-allowed; box-shadow: none; color: #7f8c8d; }
         #skip-week-button { background-color: var(--secondary-color); color: white; box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3); }
         #skip-week-button:hover:not(:disabled) { background-color: #4ba3e1; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4); } #skip-week-button:active:not(:disabled) { background-color: #2a88c9; transform: translateY(0px); box-shadow: 0 2px 5px rgba(52, 152, 219, 0.2); } #skip-week-button:disabled { background: #bdc3c7; cursor: not-allowed; box-shadow: none; color: #7f8c8d;}
         .results { opacity: 0; transform: translateY(15px); transition: opacity 0.4s ease-out, transform 0.4s ease-out; pointer-events: none; background-color: #e8f6fd; border: 1px solid #bde0fe; padding: 20px; border-radius: 8px; margin-top: 30px; min-height: 120px; position: relative; overflow: hidden; }
         .results.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
         .results h2 { margin-top: 0; color: #1e87f0; }
         #result-message { font-style: italic; margin-bottom: 15px; min-height: 25px; font-size: 1.1em; padding: 10px; border-radius: 5px; transition: background-color 0.3s ease; word-wrap: break-word; }
         #result-message.good-result { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;} #result-message.bad-result { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;} #result-message.neutral-result { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;} #result-message.skip-result { background-color: #e2e3e5; color: #383d41; border: 1px solid #d6d8db;} #result-message.fatigue-result { background-color: #ffeeba; color: #856404; border: 1px solid #ffd761; }
         .results p { margin: 8px 0; font-size: 1.05em; } .results span[id] { font-weight: 700; padding: 2px 5px; border-radius: 4px; background-color: rgba(0,0,0,0.05); }
         #cost-spent-creative { color: var(--cost-color); } #cost-spent-campaign { color: var(--primary-color); } #installs-gained { color: var(--secondary-color); } #cpi { font-weight: bold; }
         .game-over-placeholder { margin-top: 30px; text-align: center; display: none; }
         .game-over-placeholder.visible { display: block; }
         .game-over-placeholder button { background-color: #ecf0f1; color: var(--primary-color); width: auto; padding: 12px 25px; font-weight: 700; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; }
         .game-over-placeholder button:hover { background-color: #dadedf; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
         #stats-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 1000; opacity: 0; transition: opacity 0.3s ease-out; pointer-events: none; }
         #stats-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -60%) scale(0.95); background: white; padding: 25px 30px; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); z-index: 1001; opacity: 0; transition: opacity 0.3s ease-out, transform 0.3s ease-out; pointer-events: none; max-width: 550px; width: 90%; color: var(--text-dark); }
         #stats-overlay.visible, #stats-modal.visible { opacity: 1; pointer-events: auto; }
         #stats-modal.visible { transform: translate(-50%, -50%) scale(1); }
         #stats-modal h2 { color: var(--secondary-color); margin-top: 0; margin-bottom: 20px; text-align: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
         #stats-modal ul { list-style: none; padding: 0; margin: 0 0 25px 0; }
         #stats-modal li { margin-bottom: 10px; font-size: 1.05em; display: flex; justify-content: space-between; border-bottom: 1px dashed var(--border-color); padding-bottom: 5px; }
         #stats-modal li span:first-child { color: var(--text-light); } #stats-modal li span:last-child { font-weight: 700; color: var(--text-dark); }
         #stats-modal .final-reason { text-align: center; font-style: italic; margin-bottom: 20px; color: var(--primary-color); font-weight: bold; }
         #close-stats-button { display: block; margin: 0 auto; padding: 10px 25px; background-color: var(--secondary-color); color: white; border: none; border-radius: 6px; font-size: 1em; font-weight: 700; cursor: pointer; transition: background-color 0.2s ease; }
         #close-stats-button:hover { background-color: #2980b9; }

    </style>
</head>
<body>

    <div class="stats-sticky-wrapper">
        <div class="stats">
            <div>üí∞ –ë—é–¥–∂–µ—Ç <span id="budget" data-original-color="#e74c3c">10000</span> $</div>
            <div>üë• –ê—É–¥–∏—Ç–æ—Ä–∏—è <span id="audience-size" data-original-color="#3498db">0</span></div>
            <div>üí∏ –î–æ—Ö–æ–¥/–¥ <span id="daily-income" data-original-color="#2ecc71">0</span> $</div>
            <div>üìà –î–æ—Ö–æ–¥/–Ω <span id="weekly-income" data-original-color="#2ecc71">0</span> $</div>
            <div>üìÖ –ù–µ–¥–µ–ª—è <span id="week">1</span></div>
        </div>
    </div>

    <div class="container">
        <h1>üé≠ –°–∏–º—É–ª—è—Ç–æ—Ä –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ–≥–æ –ü—Ä–æ–¥—é—Å–µ—Ä–∞ üé≠</h1> <!-- –ò–∑–º–µ–Ω–µ–Ω–æ -->
        <p>–°–æ–∑–¥–∞–≤–∞–π —Ä–µ–∫–ª–∞–º—É, –ø–æ–ª—É—á–∞–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –Ω–∞ –∏–≥—Ä–æ–∫–∞—Ö! –•–æ–¥ = –Ω–µ–¥–µ–ª—è. –ö—Ä–µ–∞—Ç–∏–≤—ã "–≤—ã–≥–æ—Ä–∞—é—Ç", —Ü–µ–Ω—ã —Ä–∞—Å—Ç—É—Ç, –∏–≥—Ä–æ–∫–∏ —É—Ö–æ–¥—è—Ç, –¥–æ—Ö–æ–¥ –ø–∞–¥–∞–µ—Ç... –¶–µ–ª—å: –≤—ã–∂–∏—Ç—å!</p>

        <div class="ad-creator">
             <h2>üõ†Ô∏è –°–æ–±–∏—Ä–∞–µ–º –∫—Ä–µ–∞—Ç–∏–≤:</h2>
             <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
             <div class="option-group"><h3>1. –í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:</h3><div class="card-container" id="style-cards"><div class="card" data-category="style" data-value="2d" data-icon="üé®"><span class="card-icon">üé®</span><span class="card-title">2D –ê—Ä—Ç</span><span class="card-desc">–î–µ—à–µ–≤–æ</span></div><div class="card" data-category="style" data-value="iso" data-icon="üèõÔ∏è"><span class="card-icon">üèõÔ∏è</span><span class="card-title">–ò–∑–æ–º–µ—Ç—Ä–∏—è</span><span class="card-desc">–£–º–µ—Ä–µ–Ω–Ω–æ</span></div><div class="card" data-category="style" data-value="3d" data-icon="‚ú®"><span class="card-icon">‚ú®</span><span class="card-title">–ü–æ–ª–Ω–æ–µ 3D</span><span class="card-desc">–î–æ—Ä–æ–≥–æ</span></div></div></div>
             <div class="option-group"><h3>2. –ì–µ–π–º–ø–ª–µ–π:</h3><div class="card-container" id="gameplay-cards"><div class="card" data-category="gameplay" data-value="real" data-icon="üöú" data-cost-factor="1.0"><span class="card-icon">üöú</span><span class="card-title">–†–µ–∞–ª—å–Ω—ã–π</span><span class="card-desc">–°–∫—É—á–Ω–æ</span></div><div class="card" data-category="gameplay" data-value="exaggerated" data-icon="‚ú®" data-cost-factor="1.2"><span class="card-icon">‚ú®</span><span class="card-title">–ü—Ä–∏—É–∫—Ä–∞—à.</span><span class="card-desc">–í–µ—Å–µ–ª–µ–µ</span></div><div class="card" data-category="gameplay" data-value="fake_puzzle" data-icon="üß©" data-cost-factor="1.8"><span class="card-icon">üß©</span><span class="card-title">–§–µ–π–∫-–ø–∞–∑–ª</span><span class="card-desc">–ú–∏—Å–ª–∏–¥</span></div><div class="card" data-category="gameplay" data-value="fake_shooter" data-icon="üî´" data-cost-factor="2.2"><span class="card-icon">üî´</span><span class="card-title">–§–µ–π–∫-—à—É—Ç–µ—Ä</span><span class="card-desc">–î–æ—Ä–æ–≥–æ!</span></div><div class="card" data-category="gameplay" data-value="non_existent" data-icon="üíé" data-cost-factor="2.0"><span class="card-icon">üíé</span><span class="card-title">–ù–µ—Å—É—â.—Ñ–∏—á–∞</span><span class="card-desc">–û–±–µ—â–∞–Ω–∏—è</span></div></div></div>
             <div class="option-group"><h3>3. –ì–µ—Ä–æ–π:</h3><div class="card-container" id="character-cards"><div class="card" data-category="character" data-value="hero" data-icon="üë®‚Äçüåæ" data-cost-factor="1.0"><span class="card-icon">üë®‚Äçüåæ</span><span class="card-title">–§–µ—Ä–º–µ—Ä</span><span class="card-desc">–°—Ç–∞–Ω–¥–∞—Ä—Ç</span></div><div class="card" data-category="character" data-value="sexy" data-icon="üíÉ" data-cost-factor="1.9"><span class="card-icon">üíÉ</span><span class="card-title">–≠–ª—å—Ñ–∏–π–∫–∞</span><span class="card-desc">–ö–ª–∏–∫–±–µ–π—Ç</span></div><div class="card" data-category="character" data-value="monster" data-icon="üëπ" data-cost-factor="1.6"><span class="card-icon">üëπ</span><span class="card-title">–ú–æ–Ω—Å—Ç—Ä</span><span class="card-desc">–ú–æ–¥–µ–ª—å–∫–∞</span></div><div class="card" data-category="character" data-value="noob_vs_pro" data-icon="üòé" data-cost-factor="1.4"><span class="card-icon">üòé</span><span class="card-title">–ù—É–± vs –ü—Ä–æ</span><span class="card-desc">–ú–æ–Ω—Ç–∞–∂</span></div><div class="card" data-category="character" data-value="crying_character" data-icon="üò≠" data-cost-factor="1.1"><span class="card-icon">üò≠</span><span class="card-title">–ü–ª–∞–∫—Å–∞</span><span class="card-desc">–î—Ä–∞–º–∞</span></div></div></div>
             <div class="option-group"><h3>4. –ü—Ä–∏–∑—ã–≤:</h3><div class="card-container" id="cta-cards"><div class="card" data-category="cta" data-value="standard" data-icon="üëá" data-cost-factor="1.0"><span class="card-icon">üëá</span><span class="card-title">"–°–∫–∞—á–∞—Ç—å!"</span><span class="card-desc">–ü—Ä–æ—Å—Ç–æ</span></div><div class="card" data-category="cta" data-value="urgent" data-icon="‚è∞" data-cost-factor="1.1"><span class="card-icon">‚è∞</span><span class="card-title">"–°–†–û–ß–ù–û!"</span><span class="card-desc">–¢–∞–π–º–µ—Ä</span></div><div class="card" data-category="cta" data-value="fail" data-icon="ü§Ø" data-cost-factor="1.3"><span class="card-icon">ü§Ø</span><span class="card-title">"99% –Ω–µ—Ç!"</span><span class="card-desc">–ö–ª–∏–∫–±–µ–π—Ç</span></div><div class="card" data-category="cta" data-value="reward" data-icon="üéÅ" data-cost-factor="1.2"><span class="card-icon">üéÅ</span><span class="card-title">"100–∫ –∑–æ–ª!"</span><span class="card-desc">–ó–æ–ª–æ—Ç–æ</span></div><div class="card" data-category="cta" data-value="adult" data-icon="üîû" data-cost-factor="1.5"><span class="card-icon">üîû</span><span class="card-title">"18+"</span><span class="card-desc">–†–∏—Å–∫</span></div></div></div>
             <!-- –ü—Ä–µ–≤—å—é –∏ –°—Ç–æ–∏–º–æ—Å—Ç—å -->
             <div class="ad-preview"><h4>–ü—Ä–µ–≤—å—é –∫—Ä–µ–∞—Ç–∏–≤–∞:</h4><div class="preview-icons" id="preview-icons">‚ùì + ‚ùì + ‚ùì + ‚ùì</div></div>
             <div class="cost-summary"><div class="cost-item"><label>üí∏ –°—Ç–æ–∏–º–æ—Å—Ç—å –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞:</label><span id="creative-cost-display">---</span> $</div><div class="cost-item"><label>üì¢ –ë—é–¥–∂–µ—Ç –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è:</label><input type="number" id="campaign-cost" value="1000" min="500" step="500"> $</div></div>
             <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
              <div class="action-buttons"><button id="launch-button" disabled>–°–æ–±–µ—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤!</button><button id="skip-week-button">üò¥ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ–¥–µ–ª—é</button></div>
        </div>

        <div class="results">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ù–µ–¥–µ–ª–∏ <span id="results-week"></span>:</h2>
            <p id="result-message">–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ.</p>
              <p>üîß –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –∫—Ä–µ–∞—Ç–∏–≤: <span id="cost-spent-creative">0</span> $</p>
              <p>üì¢ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ: <span id="cost-spent-campaign">0</span> $</p>
            <p>üìà –ü–æ–ª—É—á–µ–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–æ–∫: <span id="installs-gained">0</span></p>
            <p>üìâ –£—Å—Ç–∞–ª–æ—Å—Ç—å –∫—Ä–µ–∞—Ç–∏–≤–∞: <span id="fatigue-penalty-display">-</span></p>
            <p>üéØ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (CPI): <span id="cpi">N/A</span> $</p>
             <p>üí∞ –ü–æ–ª—É—á–µ–Ω–æ –¥–æ—Ö–æ–¥–∞: <span id="income-received">0</span> $</p>
        </div>

         <!-- Placeholder –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ -->
         <div class="game-over-placeholder">
             <button onclick="location.reload()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ!</button>
         </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="stats-overlay"></div>
    <div id="stats-modal">
        <h2>üò≠ –ö–æ–Ω–µ—Ü –ò–≥—Ä—ã! üò≠</h2>
        <p class="final-reason" id="modal-reason">–ü—Ä–∏—á–∏–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞</p>
        <ul>
            <li><span>üìÖ –ü—Ä–æ–π–¥–µ–Ω–æ –Ω–µ–¥–µ–ª—å:</span> <span id="modal-final-week">0</span></li>
            <li><span>üë• –§–∏–Ω–∞–ª—å–Ω–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:</span> <span id="modal-final-audience">0</span></li>
            <li><span>üìà –ü–∏–∫–æ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:</span> <span id="modal-peak-audience">0</span></li>
            <li><span>üöÄ –ó–∞–ø—É—â–µ–Ω–æ –∫–∞–º–ø–∞–Ω–∏–π:</span> <span id="modal-campaigns-launched">0</span></li>
            <li><span>üò¥ –ü—Ä–æ–ø—É—â–µ–Ω–æ –Ω–µ–¥–µ–ª—å:</span> <span id="modal-weeks-skipped">0</span></li>
            <li><span>üí∞ –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</span> <span id="modal-total-income">0</span> $</li>
            <li><span>üîß –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –∫—Ä–µ–∞—Ç–∏–≤—ã:</span> <span id="modal-total-creative-cost">0</span> $</li>
            <li><span>üì¢ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ:</span> <span id="modal-total-campaign-cost">0</span> $</li>
            <li><span>üéØ –°—Ä–µ–¥–Ω–∏–π CPI:</span> <span id="modal-average-cpi">N/A</span> $</li>
        </ul>
        <button id="close-stats-button">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>


    <script>
        // --- Game State ---
        let budget = 10000; let totalInstalls = 0; let day = 1;
        let dailyIncome = 0; let weeklyIncome = 0;
        const incomePerInstall = 0.45; const dailyChurnRate = 0.035;
        const minBudgetForCampaign = 500; const baseCreativeCost = 500; const maxCreativeCost = 15000;
        let creativeCostInflationFactor = 1.0; const dailyInflationRate = 0.003;
        let incomeDecayFactor = 1.0; const dailyDecayRate = 0.002; const minIncomeFactor = 0.25;
        let consecutiveSameCreativeCount = 0; const fatiguePenaltyPerRepeat = 0.15; const minFatigueMultiplier = 0.3;
        let selectedStyle = null; let selectedGameplay = null; let selectedCharacter = null; let selectedCTA = null;
        let currentCreativeCost = 0;
        let lastLaunchedStyle = null; let lastLaunchedGameplay = null; let lastLaunchedCharacter = null; let lastLaunchedCTA = null;
        let currentIncomeMultiplier = 1.0;

        // Statistics
        let totalCreativeSpent = 0; let totalCampaignSpent = 0; let totalIncomeEarned = 0;
        let campaignsLaunched = 0; let weeksSkipped = 0; let peakAudience = 0;
        let finalLossReason = "";
        let gameIsOver = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ endGame

        // --- DOM Elements ---
        const budgetDisplay = document.getElementById('budget'); const audienceDisplay = document.getElementById('audience-size'); const dailyIncomeDisplay = document.getElementById('daily-income'); const weeklyIncomeDisplay = document.getElementById('weekly-income'); const weekDisplay = document.getElementById('week'); const campaignCostInput = document.getElementById('campaign-cost'); const creativeCostDisplay = document.getElementById('creative-cost-display'); const launchButton = document.getElementById('launch-button'); const resultsDiv = document.querySelector('.results'); const resultsWeekDisplay = document.getElementById('results-week'); const resultMessageDisplay = document.getElementById('result-message'); const costSpentCreativeDisplay = document.getElementById('cost-spent-creative'); const costSpentCampaignDisplay = document.getElementById('cost-spent-campaign'); const installsGainedDisplay = document.getElementById('installs-gained'); const fatiguePenaltyEl = document.getElementById('fatigue-penalty-display'); const cpiDisplay = document.getElementById('cpi'); const incomeReceivedDisplay = document.getElementById('income-received'); const gameOverPlaceholder = document.querySelector('.game-over-placeholder'); const previewIconsDiv = document.getElementById('preview-icons'); const allCards = document.querySelectorAll('.card'); const skipWeekButton = document.getElementById('skip-week-button'); // Correct ID used
        // Modal Elements
        const statsOverlay = document.getElementById('stats-overlay'); const statsModal = document.getElementById('stats-modal'); const closeModalButton = document.getElementById('close-stats-button'); const modalReasonEl = document.getElementById('modal-reason'); const modalFinalWeekEl = document.getElementById('modal-final-week'); const modalFinalAudienceEl = document.getElementById('modal-final-audience'); const modalPeakAudienceEl = document.getElementById('modal-peak-audience'); const modalCampaignsLaunchedEl = document.getElementById('modal-campaigns-launched'); const modalWeeksSkippedEl = document.getElementById('modal-weeks-skipped'); const modalTotalIncomeEl = document.getElementById('modal-total-income'); const modalTotalCreativeCostEl = document.getElementById('modal-total-creative-cost'); const modalTotalCampaignCostEl = document.getElementById('modal-total-campaign-cost'); const modalAverageCpiEl = document.getElementById('modal-average-cpi');

        let prevBudgetValue = budget; let prevAudienceValue = totalInstalls; let prevDailyIncomeValue = dailyIncome; let prevWeeklyIncomeValue = weeklyIncome;

        // --- Game Logic ---

        function flashStatUpdate(spanElement, changeType) {
            if (!spanElement) return; let flashColor = ''; const originalColor = spanElement.dataset.originalColor || 'inherit'; switch (changeType) { case 'positive': flashColor = 'var(--income-color)'; break; case 'negative': flashColor = 'var(--primary-color)'; break; case 'neutral': flashColor = 'var(--secondary-color)'; break; default: return; } spanElement.style.color = flashColor; spanElement.style.transform = 'scale(1.15)'; spanElement.style.transition = 'color 0.1s ease-out, transform 0.1s ease-out'; setTimeout(() => { spanElement.style.color = originalColor; spanElement.style.transform = 'scale(1)'; setTimeout(() => { spanElement.style.transition = ''; }, 150); }, 150);
        }

        function calculateIncomeMultiplier(style, gameplay, character, cta) {
            if (!style || !gameplay || !character || !cta) return 1.0; let t=0, m=0, h=0; switch(gameplay){case 'real':t+=0;m+=0;h+=1;break;case 'exaggerated':t+=2;m+=1;h+=3;break;case 'fake_puzzle':t+=5;m+=8;h+=6;break;case 'fake_shooter':t+=7;m+=10;h+=4;break;case 'non_existent':t+=4;m+=9;h+=7;break;} switch(character){case 'hero':t+=0;m+=0;h+=1;break;case 'sexy':t+=6;m+=4;h+=5;break;case 'monster':t+=4;m+=6;h+=3;break;case 'noob_vs_pro':t+=5;m+=2;h+=6;break;case 'crying_character':t+=7;m+=1;h+=4;break;} switch(cta){case 'standard':t+=0;m+=0;h+=1;break;case 'urgent':t+=3;m+=1;h+=4;break;case 'fail':t+=6;m+=3;h+=7;break;case 'reward':t+=4;m+=8;h+=5;break;case 'adult':t+=8;m+=5;h+=6;break;} let multi = 1.0 + (h / 50) - (m / 80); return Math.max(0.7, Math.min(1.5, multi));
        }

        function calculateDailyIncome() {
            const effectiveIncomePerInstall = Math.max(incomePerInstall * minIncomeFactor, incomePerInstall * incomeDecayFactor); dailyIncome = Math.round(totalInstalls * effectiveIncomePerInstall * currentIncomeMultiplier * 100) / 100; dailyIncome = parseFloat(dailyIncome.toFixed(2)); weeklyIncome = parseFloat((dailyIncome * 7).toFixed(2));
        }

        function calculateCreativeCost() {
            if (!selectedStyle || !selectedGameplay || !selectedCharacter || !selectedCTA) return 0; let currentBaseCost = baseCreativeCost * creativeCostInflationFactor; let cost = currentBaseCost; switch (selectedStyle) { case '2d': cost *= 1.0; break; case 'iso': cost *= 1.8; break; case '3d': cost *= 3.0; break; } const gpCard = document.querySelector(`.card[data-category='gameplay'][data-value='${selectedGameplay}']`); const chCard = document.querySelector(`.card[data-category='character'][data-value='${selectedCharacter}']`); const ctaCard = document.querySelector(`.card[data-category='cta'][data-value='${selectedCTA}']`); cost *= parseFloat(gpCard?.dataset.costFactor || 1.0); cost *= parseFloat(chCard?.dataset.costFactor || 1.0); cost *= parseFloat(ctaCard?.dataset.costFactor || 1.0); cost *= (Math.random() * 0.2 + 0.9); cost = Math.max(currentBaseCost, Math.min(maxCreativeCost * creativeCostInflationFactor, Math.round(cost))); return Math.round(cost);
        }

        function getMinimumCreativeCost() {
            let minCost = baseCreativeCost * creativeCostInflationFactor; return Math.round(minCost);
        }

        function updateDisplay() {
            if (gameIsOver) return;

            // Check Game Over conditions FIRST
            const minimumPossibleCreativeCost = getMinimumCreativeCost(); // Calculate min cost for check
            if (budget < 0) {
                endGame("–í—ã –æ–±–∞–Ω–∫—Ä–æ—Ç–∏–ª–∏—Å—å!");
                return; // Exit immediately after triggering game over
            }
            if (budget < minimumPossibleCreativeCost) {
                endGame("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤ –¥–∞–∂–µ –Ω–∞ —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π –∫—Ä–µ–∞—Ç–∏–≤!");
                return; // Exit immediately
            }

            // If game is not over, proceed with updating display
            calculateDailyIncome();

            const newBudgetValue = Math.round(budget); const newAudienceValue = totalInstalls; const newDailyIncomeValue = dailyIncome; const newWeeklyIncomeValue = weeklyIncome; const currentWeek = Math.ceil(day / 7);
            if (newBudgetValue !== prevBudgetValue) { budgetDisplay.textContent = newBudgetValue; flashStatUpdate(budgetDisplay, newBudgetValue > prevBudgetValue ? 'positive' : 'negative'); prevBudgetValue = newBudgetValue; }
            if (newAudienceValue !== prevAudienceValue) { audienceDisplay.textContent = newAudienceValue; flashStatUpdate(audienceDisplay, newAudienceValue > prevAudienceValue ? 'positive' : 'negative'); prevAudienceValue = newAudienceValue; peakAudience = Math.max(peakAudience, newAudienceValue); }
            dailyIncomeDisplay.textContent = newDailyIncomeValue.toFixed(2); if (newDailyIncomeValue !== prevDailyIncomeValue) { flashStatUpdate(dailyIncomeDisplay, 'neutral'); prevDailyIncomeValue = newDailyIncomeValue; }
            weeklyIncomeDisplay.textContent = newWeeklyIncomeValue.toFixed(2); if (newWeeklyIncomeValue !== prevWeeklyIncomeValue) { flashStatUpdate(weeklyIncomeDisplay, 'neutral'); prevWeeklyIncomeValue = newWeeklyIncomeValue; }
            weekDisplay.textContent = currentWeek;

            currentCreativeCost = calculateCreativeCost(); // Recalculate potentially changed cost
            creativeCostDisplay.textContent = currentCreativeCost > 0 ? currentCreativeCost : "---";

            // Campaign Cost Input Validation & State Update
             const currentMinBudget = parseInt(campaignCostInput.min); const currentStep = parseInt(campaignCostInput.step); let campaignCost = parseInt(campaignCostInput.value) || currentMinBudget; if (isNaN(campaignCost) || campaignCost < currentMinBudget) campaignCost = currentMinBudget; campaignCost = Math.round(campaignCost / currentStep) * currentStep; campaignCost = Math.max(currentMinBudget, campaignCost);
            const totalCost = currentCreativeCost + campaignCost; const canAfford = budget >= totalCost; const allSelected = selectedStyle && selectedGameplay && selectedCharacter && selectedCTA;

            // Launch Button State
            if (allSelected && canAfford) { launchButton.disabled = false; launchButton.textContent = `üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å! (${totalCost}$)`; }
            else { launchButton.disabled = true; if (!allSelected) { launchButton.textContent = "–°–æ–±–µ—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤!"; } else if (!canAfford) { launchButton.textContent = `–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ${totalCost - Math.round(budget)}$!`; } else { launchButton.textContent = "–û—à–∏–±–∫–∞"; } }
            skipWeekButton.disabled = false;

            // Campaign Cost Input Max/Value Correction
            const maxCampaignBudget = Math.max(0, budget - currentCreativeCost); let calculatedMax = Math.floor(maxCampaignBudget / currentStep) * currentStep; campaignCostInput.max = Math.max(currentMinBudget, calculatedMax);
             let currentInputValue = parseInt(campaignCostInput.value); if (isNaN(currentInputValue)) currentInputValue = currentMinBudget; if (currentInputValue > campaignCostInput.max) { campaignCostInput.value = campaignCostInput.max; } else if (currentInputValue < currentMinBudget) { campaignCostInput.value = currentMinBudget; } else { let roundedValue = Math.round(currentInputValue / currentStep) * currentStep; roundedValue = Math.max(currentMinBudget, roundedValue); if (roundedValue > campaignCostInput.max) roundedValue = campaignCostInput.max; if (campaignCostInput.value != roundedValue) campaignCostInput.value = roundedValue; }

            updatePreview();
        }

        function updatePreview() {
            if (gameIsOver) return; const iS = document.querySelector('#style-cards .card.selected')?.dataset.icon||'‚ùì'; const iG = document.querySelector('#gameplay-cards .card.selected')?.dataset.icon||'‚ùì'; const iC = document.querySelector('#character-cards .card.selected')?.dataset.icon||'‚ùì'; const iT = document.querySelector('#cta-cards .card.selected')?.dataset.icon||'‚ùì'; previewIconsDiv.textContent = `${iS} + ${iG} + ${iC} + ${iT}`;
        }

        function calculateAdEffectiveness(gameplay, character, cta) {
            let t=0,m=0,h=0; switch(gameplay){case 'real':t+=0;m+=0;h+=1;break;case 'exaggerated':t+=2;m+=1;h+=3;break;case 'fake_puzzle':t+=5;m+=8;h+=6;break;case 'fake_shooter':t+=7;m+=10;h+=4;break;case 'non_existent':t+=4;m+=9;h+=7;break;} switch(character){case 'hero':t+=0;m+=0;h+=1;break;case 'sexy':t+=6;m+=4;h+=5;break;case 'monster':t+=4;m+=6;h+=3;break;case 'noob_vs_pro':t+=5;m+=2;h+=6;break;case 'crying_character':t+=7;m+=1;h+=4;break;} switch(cta){case 'standard':t+=0;m+=0;h+=1;break;case 'urgent':t+=3;m+=1;h+=4;break;case 'fail':t+=6;m+=3;h+=7;break;case 'reward':t+=4;m+=8;h+=5;break;case 'adult':t+=8;m+=5;h+=6;break;} const baseEff = (h*1.5 + t*0.8 + m*1.2) * (Math.random()*0.4+0.8); const potentialInstalls = Math.max(1, Math.floor(baseEff)); return { potentialInstallsPer100DollarsCampaign: potentialInstalls, trashiness: t, misleadingness: m, hype: h };
        }

        function clearSelections() {
             selectedStyle = null; selectedGameplay = null; selectedCharacter = null; selectedCTA = null;
             allCards.forEach(card => { card.classList.remove('selected'); card.style.transform = ''; });
             updatePreview(); creativeCostDisplay.textContent = "---";
        }

        function advanceEconomy() {
            let totalChurnThisWeek = 0; let totalIncomeThisWeek = 0;
             for (let i = 0; i < 7; i++) {
                 const churnToday = Math.floor(totalInstalls * dailyChurnRate); totalInstalls -= churnToday; totalInstalls = Math.max(0, totalInstalls); totalChurnThisWeek += churnToday;
                 const effectiveIncomePerInstall = Math.max(incomePerInstall * minIncomeFactor, incomePerInstall * incomeDecayFactor); const incomeToday = parseFloat((totalInstalls * effectiveIncomePerInstall * currentIncomeMultiplier).toFixed(2)); totalIncomeThisWeek += incomeToday;
                 creativeCostInflationFactor += dailyInflationRate; incomeDecayFactor = Math.max(minIncomeFactor, incomeDecayFactor - dailyDecayRate); day++;
             }
             return { incomeEarnedThisWeek: parseFloat(totalIncomeThisWeek.toFixed(2)), churnedThisWeek: totalChurnThisWeek };
         }

        // --- CORE TURN LOGIC: LAUNCH CAMPAIGN ---
        function launchCampaign() {
            if (gameIsOver || launchButton.disabled) return;
            resultsDiv.classList.remove('visible');

            const campaignCost = parseInt(campaignCostInput.value);
            const creativeCost = currentCreativeCost; // Already calculated with inflation
            const totalCost = creativeCost + campaignCost;

            // Final funds check
            if (budget < totalCost) { setResultMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!", "bad-result"); resultsDiv.classList.add('visible'); updateDisplay(); return; }

            // Creative Fatigue
             let fatiguePenalty = 1.0; const isSameCreative = selectedStyle === lastLaunchedStyle && selectedGameplay === lastLaunchedGameplay && selectedCharacter === lastLaunchedCharacter && selectedCTA === lastLaunchedCTA;
             if (isSameCreative && selectedStyle) { consecutiveSameCreativeCount++; fatiguePenalty = Math.max(minFatigueMultiplier, 1.0 - consecutiveSameCreativeCount * fatiguePenaltyPerRepeat); } else { consecutiveSameCreativeCount = 0; }

             // Advance week economy & get results
             const weekResults = advanceEconomy(); const incomeEarned = weekResults.incomeEarnedThisWeek; const churnedInstalls = weekResults.churnedThisWeek;
             budget += incomeEarned; totalIncomeEarned += incomeEarned;

             // Spend
             budget -= totalCost; totalCreativeSpent += creativeCost; totalCampaignSpent += campaignCost;

            // Calculate New Installs (with fatigue)
            const { potentialInstallsPer100DollarsCampaign, trashiness, misleadingness, hype } = calculateAdEffectiveness(selectedGameplay, selectedCharacter, selectedCTA);
            let installsGained = Math.floor((campaignCost / 100) * potentialInstallsPer100DollarsCampaign * (Math.random() * 0.5 + 0.75));
            installsGained = Math.max(0, Math.floor(installsGained * fatiguePenalty));

            // Update Last Launched & Multiplier
             lastLaunchedStyle = selectedStyle; lastLaunchedGameplay = selectedGameplay; lastLaunchedCharacter = selectedCharacter; lastLaunchedCTA = selectedCTA;
             currentIncomeMultiplier = calculateIncomeMultiplier(lastLaunchedStyle, lastLaunchedGameplay, lastLaunchedCharacter, lastLaunchedCTA);

            // Events & Messaging
            let resultMessage = ""; let resultClass = "neutral-result"; let messageIcon = "üìä"; let penalty = 0;
             if (trashiness + misleadingness > 25 && Math.random() < 0.18) { const boost = (Math.random() * 1.5 + 1.5); installsGained = Math.floor(installsGained * boost); messageIcon = "ü•≥"; resultMessage = `–í–ò–†–£–° ${boost.toFixed(1)}x! üî• `; resultClass = "good-result"; }
             else if (trashiness + misleadingness > 18) { messageIcon = "üëç"; resultMessage = "–•–æ—Ä–æ—à–∏–π —Ç—Ä–µ—à–∞–∫! "; resultClass = "good-result"; }
             else if (trashiness + misleadingness < 6) { messageIcon = "üò¥"; resultMessage = "–°–∫—É—á–Ω–æ–≤–∞—Ç–æ –≤—ã—à–ª–æ... "; installsGained = Math.floor(installsGained * 0.6); resultClass = "bad-result"; }
             else { messageIcon = "üìà"; resultMessage = "–ö–∞–º–ø–∞–Ω–∏—è –∫–∞–∫ –∫–∞–º–ø–∞–Ω–∏—è. "; }
             if (fatiguePenalty < 1.0) { messageIcon = "üò©"; resultMessage += ` –ö—Ä–µ–∞—Ç–∏–≤ –≤—ã–≥–æ—Ä–µ–ª! (-${Math.round((1 - fatiguePenalty) * 100)}% —É—Å—Ç.) `; resultClass = resultClass === "bad-result" ? "bad-result" : "fatigue-result"; }
             if (misleadingness > 14 && Math.random() < 0.15) { penalty = Math.round(Math.min(Math.max(500, budget * 0.25), 4000)); messageIcon = "üò±"; resultMessage += ` –®–¢–†–ê–§ ${penalty}$! üí∏`; installsGained = Math.floor(installsGained * 0.4); resultClass = "bad-result"; }
             budget -= penalty; resultMessage += ` (+${incomeEarned.toFixed(2)}$ –¥–æ—Ö./–Ω–µ–¥., ${churnedInstalls} —É—à–ª–æ/–Ω–µ–¥.)`;

             // Add New Installs & Update Stats
            totalInstalls += installsGained;
            campaignsLaunched++;

            // Update Results Display
            const currentWeek = Math.ceil((day - 1) / 7);
            resultsWeekDisplay.textContent = currentWeek;
            setResultMessage(messageIcon + " " + resultMessage, resultClass);
            costSpentCreativeDisplay.textContent = creativeCost; costSpentCampaignDisplay.textContent = campaignCost; installsGainedDisplay.textContent = installsGained;
             if(fatiguePenaltyEl) fatiguePenaltyEl.textContent = `${Math.round((1-fatiguePenalty)*100)}%`;
            const cpi = installsGained > 0 ? (totalCost / installsGained).toFixed(2) : "---"; cpiDisplay.textContent = `${cpi} $`; incomeReceivedDisplay.textContent = incomeEarned.toFixed(2);
            resultsDiv.classList.add('visible');

            // Update UI for next turn (this will also check for game over again)
             updateDisplay();
        }

        // --- CORE TURN LOGIC: SKIP WEEK ---
        function skipWeek() {
            if (gameIsOver || skipWeekButton.disabled) return;
            resultsDiv.classList.remove('visible');

             consecutiveSameCreativeCount = 0; // Reset fatigue

             // Advance week economy & get results
             const weekResults = advanceEconomy(); const incomeEarned = weekResults.incomeEarnedThisWeek; const churnedInstalls = weekResults.churnedThisWeek;
             budget += incomeEarned; totalIncomeEarned += incomeEarned; weeksSkipped++;

            // Update Results Display
             const endedWeek = Math.ceil((day - 1) / 7);
             resultsWeekDisplay.textContent = endedWeek;
             setResultMessage(`üò¥ –ù–µ–¥–µ–ª—è ${endedWeek} –ø—Ä–æ–ø—É—â–µ–Ω–∞. –î–æ—Ö–æ–¥ ${incomeEarned.toFixed(2)}$. –£—à–ª–æ: ${churnedInstalls}`, "skip-result");
             costSpentCreativeDisplay.textContent = "0"; costSpentCampaignDisplay.textContent = "0"; installsGainedDisplay.textContent = "0";
             if(fatiguePenaltyEl) fatiguePenaltyEl.textContent = '0%'; cpiDisplay.textContent = "---"; incomeReceivedDisplay.textContent = incomeEarned.toFixed(2);
             resultsDiv.classList.add('visible');

            // Update UI for next turn (this will also check for game over again)
             updateDisplay();
        }

        function setResultMessage(message, className = "") {
            if(resultMessageDisplay) {
                resultMessageDisplay.textContent = message;
                resultMessageDisplay.className = 'result-message'; // Base class first
                if (className) { resultMessageDisplay.classList.add(className); }
            }
         }

        function endGame(reason) {
            if (gameIsOver) return;
            gameIsOver = true;
            finalLossReason = reason;

            launchButton.disabled = true; launchButton.textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞";
            skipWeekButton.disabled = true;
            if (document.querySelector('.ad-creator')) { document.querySelector('.ad-creator').style.display = 'none'; }
            resultsDiv.classList.remove('visible');
            clearSelections();

            const finalWeek = Math.ceil(day / 7);
             peakAudience = Math.max(peakAudience, totalInstalls);
             const totalSpent = totalCreativeSpent + totalCampaignSpent;
             const approxTotalGenerated = peakAudience > 0 ? peakAudience : 1; // Avoid division by zero for CPI calc
             const averageCpi = totalSpent > 0 && approxTotalGenerated > 0 ? (totalSpent / approxTotalGenerated) : 0;

            // Safely update modal elements
             if (modalReasonEl) modalReasonEl.textContent = finalLossReason;
             if (modalFinalWeekEl) modalFinalWeekEl.textContent = finalWeek;
             if (modalFinalAudienceEl) modalFinalAudienceEl.textContent = totalInstalls;
             if (modalPeakAudienceEl) modalPeakAudienceEl.textContent = peakAudience;
             if (modalCampaignsLaunchedEl) modalCampaignsLaunchedEl.textContent = campaignsLaunched;
             if (modalWeeksSkippedEl) modalWeeksSkippedEl.textContent = weeksSkipped;
             if (modalTotalIncomeEl) modalTotalIncomeEl.textContent = Math.round(totalIncomeEarned);
             if (modalTotalCreativeCostEl) modalTotalCreativeCostEl.textContent = Math.round(totalCreativeSpent);
             if (modalTotalCampaignCostEl) modalTotalCampaignCostEl.textContent = Math.round(totalCampaignSpent);
             if (modalAverageCpiEl) modalAverageCpiEl.textContent = averageCpi > 0 ? averageCpi.toFixed(2) : "N/A";

             if (statsOverlay) statsOverlay.classList.add('visible');
             if (statsModal) statsModal.classList.add('visible');
             if (gameOverPlaceholder) gameOverPlaceholder.classList.add('visible');
        }

        // --- Event Listeners ---
        allCards.forEach(card => { card.addEventListener('click', () => { if (gameIsOver) return; const container = card.closest('.card-container'); if (!container) return; const value = card.dataset.value; const category = card.dataset.category; container.querySelectorAll('.card').forEach(sibling => { sibling.classList.remove('selected'); sibling.style.transform = ''; }); card.classList.add('selected'); if (category === 'style') selectedStyle = value; else if (category === 'gameplay') selectedGameplay = value; else if (category === 'character') selectedCharacter = value; else if (category === 'cta') selectedCTA = value; updateDisplay(); }); });
        launchButton.addEventListener('click', launchCampaign);
        skipWeekButton.addEventListener('click', skipWeek);
        campaignCostInput.addEventListener('input', () => { if (gameIsOver) return; updateDisplay(); });
        campaignCostInput.addEventListener('blur', () => { if (gameIsOver) return; updateDisplay(); });

        // Modal Close Listeners
        if (closeModalButton) { closeModalButton.addEventListener('click', () => { if (statsOverlay) statsOverlay.classList.remove('visible'); if (statsModal) statsModal.classList.remove('visible'); }); }
        if (statsOverlay) { statsOverlay.addEventListener('click', () => { if (statsOverlay) statsOverlay.classList.remove('visible'); if (statsModal) statsModal.classList.remove('visible'); }); }

        // --- Initial Setup ---
        document.querySelectorAll('.stats span[id]').forEach(span => { if(span) span.dataset.originalColor = window.getComputedStyle(span).color; });
        updateDisplay();
        updatePreview();

    </script>
</body>
</html>
